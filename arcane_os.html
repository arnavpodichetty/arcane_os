<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>A.R.C.A.N.E. V3.1 | Systems Online</title>
    <style>
        :root {
            --primary: #00ff41;
            --dim: #003b00;
            --alert: #ff3333;
            --bg: #000800;
            --glass: rgba(0, 10, 0, 0.9);
            --font: 'Consolas', 'Monaco', monospace;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0; overflow: hidden; background: var(--bg);
            font-family: var(--font); color: var(--primary);
            height: 100vh; width: 100vw;
        }

        canvas { position: absolute; top: 0; left: 0; z-index: 0; opacity: 0.2; }

        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10; padding: 20px; display: flex; gap: 20px;
        }

        .window {
            background: var(--glass);
            border: 1px solid var(--primary);
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.1);
            display: flex; flex-direction: column;
            backdrop-filter: blur(5px);
        }

        #terminal-win { flex: 2; height: 100%; }
        #status-win { flex: 1; display: flex; flex-direction: column; gap: 20px; background: transparent; border: none; box-shadow: none; backdrop-filter: none; }

        .panel {
            background: var(--glass); border: 1px solid var(--primary);
            padding: 15px; flex: 1; position: relative;
        }

        .header {
            background: var(--dim); color: var(--primary);
            padding: 5px 10px; font-weight: bold; border-bottom: 1px solid var(--primary);
            display: flex; justify-content: space-between;
        }

        #output {
            flex-grow: 1; overflow-y: auto; padding: 15px;
            font-size: 14px; line-height: 1.5; white-space: pre-wrap;
            text-shadow: 0 0 5px var(--primary);
        }

        #input-line {
            display: flex; padding: 10px; background: rgba(0,0,0,0.5);
            border-top: 1px solid var(--primary);
        }

        #prompt { font-weight: bold; margin-right: 10px; }
        
        input {
            background: transparent; border: none; color: #fff;
            flex-grow: 1; font-family: var(--font); font-size: 14px;
            outline: none; caret-color: var(--primary);
        }

        .dir { color: #55ffff; font-weight: bold; }
        .exe { color: #ff5555; font-weight: bold; }
        .txt { color: #ffffff; }
        .success { color: #00ff41; }
        .error { color: #ff3333; }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background: var(--dim); border: 1px solid var(--primary); }

        @keyframes glitch {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }
        .shaking { animation: glitch 0.3s infinite; color: var(--alert); border-color: var(--alert); }
    </style>
</head>
<body>

    <canvas id="bgCanvas"></canvas>

    <div id="ui-layer">
        <div id="terminal-win" class="window">
            <div class="header">
                <span>TERMINAL_UPLINK_V3.1</span>
                <span>[SECURE]</span>
            </div>
            <div id="output">
                <div>A.R.C.A.N.E. OS [Version 3.1.4 (Patched)]</div>
                <div>System Integrity: CRITICAL</div>
                <div>Core Access: LOCKED</div>
                <br>
                <div class="success">Welcome, Administrator. Type 'help' for commands.</div>
                <br>
            </div>
            <div id="input-line">
                <span id="prompt">root@arcane:~$</span>
                <input type="text" id="cmd" autofocus autocomplete="off" spellcheck="false">
            </div>
        </div>

        <div id="status-win">
            <div class="panel">
                <div class="header">FILESYSTEM_NAV</div>
                <div id="tree-view" style="padding-top: 10px; font-size: 12px; color: #aaa;">
                    /root<br>
                    ├── system/<br>
                    ├── logs/<br>
                    └── admin/
                </div>
            </div>
            <div class="panel">
                <div class="header">CPU_THREAD_0</div>
                <canvas id="graphCanvas" style="width: 100%; height: 80%;"></canvas>
            </div>
            <div class="panel">
                 <div class="header">NETWORK</div>
                 <div id="net-log" style="font-size: 10px; overflow: hidden; height: 100%;"></div>
            </div>
        </div>
    </div>

    <script>
        // --- SOUND ENGINE ---
        const AudioSys = {
            ctx: new (window.AudioContext || window.webkitAudioContext)(),
            play(type) {
                if (this.ctx.state === 'suspended') this.ctx.resume();
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                
                if (type === 'key') {
                    osc.frequency.value = 800 + Math.random() * 200;
                    osc.type = 'triangle';
                    gain.gain.value = 0.05;
                    osc.connect(gain);
                    gain.connect(this.ctx.destination);
                    osc.start();
                    osc.stop(this.ctx.currentTime + 0.05);
                } else if (type === 'error') {
                    osc.frequency.value = 150;
                    osc.type = 'sawtooth';
                    gain.gain.value = 0.1;
                    osc.connect(gain);
                    gain.connect(this.ctx.destination);
                    osc.start();
                    gain.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + 0.3);
                    osc.stop(this.ctx.currentTime + 0.3);
                } else if (type === 'success') {
                    osc.frequency.value = 1200;
                    gain.gain.value = 0.1;
                    osc.connect(gain);
                    gain.connect(this.ctx.destination);
                    osc.start();
                    osc.frequency.exponentialRampToValueAtTime(2000, this.ctx.currentTime + 0.2);
                    gain.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + 0.2);
                    osc.stop(this.ctx.currentTime + 0.2);
                }
            }
        };

        // --- VIRTUAL FILE SYSTEM ---
        const FileSystem = {
            tree: {
                "readme.txt": "MISSION: The Core is locked. Find the override code in the logs and execute the unlocker in the admin folder.",
                "system": {
                    "kernel.sys": "BINARY_DATA_CORRUPTED",
                    "drivers": {
                        "display.dr": "Display driver OK"
                    }
                },
                "logs": {
                    "boot.log": "System boot... OK\nMounting drives... OK",
                    "chat_history.txt": "USER_A: Did you set the new core password?\nUSER_B: Yeah, I set it to the year the first AI passed the Turing test.\nUSER_A: 2029? That's insecure.\nUSER_B: Whatever, nobody looks here."
                },
                "admin": {
                    "unlock_core.exe": "EXEC_REQUIRED",
                    "notes.txt": "Don't forget to run 'crack.exe' if you lose the password."
                },
                "bin": {
                    "crack.exe": "EXEC_REQUIRED",
                    "matrix.exe": "EXEC_REQUIRED"
                }
            },
            currentPath: []
        };

        // --- TERMINAL LOGIC ---
        const Terminal = {
            input: document.getElementById('cmd'),
            output: document.getElementById('output'),
            prompt: document.getElementById('prompt'),
            history: [],
            historyIndex: -1,
            isLocked: false, // LOCK STATE ADDED

            init() {
                this.input.addEventListener('keydown', (e) => {
                    if (this.isLocked) return; // IGNORE INPUT IF LOCKED
                    
                    if (e.key === 'Enter') this.handleCommand();
                    if (e.key === 'ArrowUp') this.navHistory(-1);
                    if (e.key === 'ArrowDown') this.navHistory(1);
                    AudioSys.play('key');
                });
                this.input.focus();
                document.addEventListener('click', () => this.input.focus());
            },

            navHistory(dir) {
                if (this.history.length === 0) return;
                this.historyIndex += dir;
                if (this.historyIndex < 0) this.historyIndex = 0;
                if (this.historyIndex >= this.history.length) {
                    this.historyIndex = this.history.length;
                    this.input.value = "";
                    return;
                }
                this.input.value = this.history[this.historyIndex];
            },

            print(text, type = '') {
                const line = document.createElement('div');
                line.className = type;
                line.textContent = text;
                this.output.appendChild(line);
                this.output.scrollTop = this.output.scrollHeight;
            },

            getDir(pathArray) {
                let current = FileSystem.tree;
                for (const p of pathArray) {
                    if (current[p]) current = current[p];
                    else return null;
                }
                return current;
            },

            async handleCommand() {
                const val = this.input.value.trim();
                if (!val) return;
                
                this.print(`root@arcane:/${FileSystem.currentPath.join('/')}$ ${val}`, 'txt');
                this.history.push(val);
                this.historyIndex = this.history.length;
                this.input.value = '';

                const parts = val.split(' ');
                const cmd = parts[0].toLowerCase();
                const arg = parts[1];

                // --- COMMAND HANDLERS ---
                
                switch(cmd) {
                    case 'help':
                        this.print("AVAILABLE COMMANDS:", 'success');
                        this.print("  ls             - List directory contents");
                        this.print("  cd [folder]    - Change directory (.. to go back)");
                        this.print("  cat [file]     - Read text file");
                        this.print("  run [exe]      - Execute program");
                        this.print("  clear          - Clear screen");
                        break;

                    case 'clear':
                        this.output.innerHTML = '';
                        break;

                    case 'ls':
                        const dir = this.getDir(FileSystem.currentPath);
                        if (typeof dir === 'object') {
                            for (const key in dir) {
                                let style = 'txt';
                                if (typeof dir[key] === 'object') style = 'dir';
                                else if (key.endsWith('.exe')) style = 'exe';
                                this.print(`${style === 'dir' ? '[DIR] ' : ''}${key}`, style);
                            }
                        } else {
                            this.print("Not a directory.", 'error');
                        }
                        break;

                    case 'cd':
                        if (!arg) {
                            FileSystem.currentPath = [];
                            this.print("Returned to root.");
                            return;
                        }
                        if (arg === '..') {
                            FileSystem.currentPath.pop();
                        } else {
                            const nextDir = this.getDir([...FileSystem.currentPath, arg]);
                            if (nextDir && typeof nextDir === 'object') {
                                FileSystem.currentPath.push(arg);
                            } else {
                                this.print(`Directory '${arg}' not found.`, 'error');
                                AudioSys.play('error');
                            }
                        }
                        break;

                    case 'cat':
                        if (!arg) return this.print("Usage: cat [filename]", 'error');
                        const file = this.getDir([...FileSystem.currentPath, arg]);
                        if (file && typeof file === 'string') {
                            if (file === "EXEC_REQUIRED") this.print("Binary file. Use 'run'.", 'error');
                            else this.print(file, 'success');
                        } else {
                            this.print("File not found.", 'error');
                        }
                        break;

                    case 'run':
                        if (!arg) return this.print("Usage: run [filename]", 'error');
                        
                        // UNLOCK CORE MISSION LOGIC
                        if (arg === 'unlock_core.exe') {
                             this.print("AUTHENTICATION REQUIRED. ENTER PASSCODE:", 'alert');
                             
                             // LOCK MAIN TERMINAL
                             this.isLocked = true;
                             const oldPlaceholder = this.input.placeholder;
                             this.input.placeholder = "ENTER PASSCODE...";
                             this.input.value = "";
                             
                             const passHandler = (e) => {
                                 if(e.key === 'Enter') {
                                     const pass = this.input.value;
                                     
                                     // 1. Clear inputs
                                     this.input.value = '';
                                     this.input.placeholder = oldPlaceholder;
                                     
                                     // 2. Check Pass
                                     if(pass === '2029') {
                                         AudioSys.play('success');
                                         this.print("ACCESS GRANTED. CORE UNLOCKED.", 'success');
                                         this.print("SYSTEM RESTORE INITIATED...", 'success');
                                         document.body.style.background = "#002200";
                                         // Stop Matrix, Start Celebration
                                         // (Optional visual change here)
                                     } else {
                                         AudioSys.play('error');
                                         this.print("ACCESS DENIED.", 'error');
                                         document.getElementById('terminal-win').classList.add('shaking');
                                         setTimeout(()=>document.getElementById('terminal-win').classList.remove('shaking'), 500);
                                     }

                                     // 3. Remove Handler & Unlock
                                     this.input.removeEventListener('keydown', passHandler);
                                     this.isLocked = false; 
                                 }
                             };
                             // Add new listener
                             this.input.addEventListener('keydown', passHandler);
                             return;
                        }

                        if (arg === 'crack.exe') {
                            this.visualHack();
                            return;
                        }

                        this.print("Program not found or invalid context.", 'error');
                        break;

                    default:
                        this.print(`Command '${cmd}' not recognized.`, 'error');
                }
            },

            async visualHack() {
                this.print("INITIATING BRUTE FORCE ATTACK...", 'exe');
                const chars = "0123456789ABCDEF";
                for(let i=0; i<20; i++) {
                    let str = "";
                    for(let j=0; j<32; j++) str += chars[Math.floor(Math.random()*16)];
                    this.print(str, 'dim');
                    await new Promise(r => setTimeout(r, 50));
                }
                this.print("FAILURE. ENCRYPTION TOO STRONG.", 'error');
            }
        };

        // --- VISUALS ---
        const Visuals = {
            init() {
                // Matrix Rain
                const c = document.getElementById('bgCanvas');
                const ctx = c.getContext('2d');
                let w = c.width = window.innerWidth;
                let h = c.height = window.innerHeight;
                const cols = Math.floor(w / 20);
                const ypos = Array(cols).fill(0);

                setInterval(() => {
                    ctx.fillStyle = '#0001';
                    ctx.fillRect(0, 0, w, h);
                    ctx.fillStyle = '#0f0';
                    ctx.font = '15pt monospace';
                    ypos.forEach((y, i) => {
                        const text = String.fromCharCode(Math.random() * 128);
                        const x = i * 20;
                        ctx.fillText(text, x, y);
                        if (y > h + Math.random() * 10000) ypos[i] = 0;
                        else ypos[i] = y + 20;
                    });
                }, 50);

                // CPU Graph
                const gC = document.getElementById('graphCanvas');
                const gCtx = gC.getContext('2d');
                const data = new Array(50).fill(50);
                setInterval(() => {
                    data.shift();
                    data.push(Math.random() * 100);
                    gCtx.clearRect(0, 0, 300, 150);
                    gCtx.beginPath();
                    gCtx.strokeStyle = '#0f0';
                    gCtx.lineWidth = 2;
                    data.forEach((d, i) => {
                        const x = i * (gC.width / 50);
                        const y = gC.height - (d / 100 * gC.height);
                        if(i===0) gCtx.moveTo(x,y); else gCtx.lineTo(x,y);
                    });
                    gCtx.stroke();
                }, 100);

                // Network Log
                const net = document.getElementById('net-log');
                setInterval(() => {
                    const ips = ["192.168.1.40", "10.0.0.5", "172.16.0.1"];
                    const status = ["ACK", "SYN", "FIN", "RST"];
                    const p = document.createElement('div');
                    p.innerText = `> ${ips[Math.floor(Math.random()*3)]} : ${status[Math.floor(Math.random()*4)]}`;
                    net.prepend(p);
                    if(net.children.length > 15) net.lastChild.remove();
                }, 800);
            }
        };

        window.onload = () => {
            Terminal.init();
            Visuals.init();
        };
    </script>
</body>
</html>